<form id="feedbackForm" method="post">
    {% csrf_token %}
    <div class="mb-3">
        {{ form.content.label_tag }}
        {{ form.content }}
        <div id="content-error" class="text-danger"></div>
    </div>
    <div class="mb-3">
        {{ form.rating.label_tag }}
        {{ form.rating }}
        <div id="rating-error" class="text-danger"></div>
    </div>
    <button type="submit" class="btn btn-primary">Submit Feedback</button>
</form>

<!-- Feedback Success Message -->
<div id="feedback-success" class="alert alert-success mt-3" style="display:none;">
    Your feedback has been submitted successfully!
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#feedbackForm").on("submit", function (e) {
            e.preventDefault();  // Prevent default form submission

            // Collect form data
            const formData = $(this).serialize();

            // Submit via AJAX
            $.ajax({
                url: "{% url 'feedback' %}",  // URL of the feedback view
                type: "POST",
                data: formData,
                success: function (response) {
                    // Handle success
                    $("#feedbackForm")[0].reset();
                    $("#feedback-success").fadeIn().delay(3000).fadeOut();
                },
                error: function (xhr) {
                    // Handle validation errors
                    const errors = xhr.responseJSON.errors;
                    if (errors.content) {
                        $("#content-error").text(errors.content);
                    } else {
                        $("#content-error").text('');
                    }
                    if (errors.rating) {
                        $("#rating-error").text(errors.rating);
                    } else {
                        $("#rating-error").text('');
                    }
                }
            });
        });
    });
</script>
